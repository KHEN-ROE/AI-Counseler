version: '3'

services:
  counsel:  # 스프링부트 애플리케이션 서비스명
    image: kenroe0421/counsel:v2  # 도커허브에 push한 커스텀 이미지
    restart: always
    ports:
      - "8080:8080"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/counsel #이 컨테이너에서 사용할 환경변수 정의 / 이전에는 컨테이너에 접근했음(커스텀 mysql이미지를 만들었다. 그러나 그럴 필요 없이 공식 mysql 이미지 사용하면 됨)
      - SPRING_DATASOURCE_USERNAME=ken
      - SPRING_DATASOURCE_PASSWORD=1234
    depends_on:
      - mysql

  mysql:  # MySQL 서비스명
    image: mysql:8.0  # 도커 허브의 공식 MySQL 이미지
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=1234
      - MYSQL_DATABASE=counsel
      - MYSQL_USER=ken
      - MYSQL_PASSWORD=1234
    volumes:
      - mysql-data:/var/lib/mysql

volumes:
  mysql-data:
